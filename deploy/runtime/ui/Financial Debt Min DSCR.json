{
    "Name": "Financial Debt Min DSCR",
    "Width": 867.0,
    "Height": 151.0,
    "FormObjects": {
        "GroupBox": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "GroupBox1"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 6.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 3.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 850.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 143.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Caption": {
                    "Type": 5.0,
                    "String": "Project Term Debt"
                },
                "Bold": {
                    "Type": 2.0,
                    "Boolean": 1.0
                }
            }
        },
        "Label": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "Label2"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 576.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 18.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 269.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 66.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Caption": {
                    "Type": 5.0,
                    "String": "The weighted average cost of capital (WACC) is displayed for reference. SAM does not use the value for calculations."
                },
                "TextColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 0.0,
                        "Green": 0.0,
                        "Blue": 0.0,
                        "Alpha": 255.0
                    }
                },
                "Bold": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "FontSize": {
                    "Type": 3.0,
                    "Integer": 0.0
                },
                "WordWrap": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "AlignRight": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "AlignTop": {
                    "Type": 2.0,
                    "Boolean": 1.0
                }
            }
        },
        "Numeric": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "debt_fraction"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 153.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 33.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 100.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 21.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Value": {
                    "Type": 1.0,
                    "Double": 0.0
                },
                "Mode": {
                    "Type": 3.0,
                    "Integer": 1.0
                },
                "Format": {
                    "Type": 3.0,
                    "Integer": 1.0
                },
                "Decimals": {
                    "Type": 3.0,
                    "Integer": 3.0
                },
                "Prefix": {
                    "Type": 5.0,
                    "String": ""
                },
                "Suffix": {
                    "Type": 5.0,
                    "String": ""
                },
                "ThousandsSep": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "Editable": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "ForeColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 0.0,
                        "Green": 0.0,
                        "Blue": 0.0,
                        "Alpha": 255.0
                    }
                },
                "BackColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 255.0,
                        "Green": 255.0,
                        "Blue": 255.0,
                        "Alpha": 255.0
                    }
                },
                "TabOrder": {
                    "Type": 3.0,
                    "Integer": 1.0
                }
            }
        },
        "Label": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "debt_message"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 19.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 105.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 541.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 37.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Caption": {
                    "Type": 5.0,
                    "String": ""
                },
                "TextColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 255.0,
                        "Green": 0.0,
                        "Blue": 0.0,
                        "Alpha": 255.0
                    }
                },
                "Bold": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "FontSize": {
                    "Type": 3.0,
                    "Integer": 0.0
                },
                "WordWrap": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "AlignRight": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "AlignTop": {
                    "Type": 2.0,
                    "Boolean": 1.0
                }
            }
        },
        "Numeric": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "loan_rate"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 153.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 81.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 100.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 21.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Value": {
                    "Type": 1.0,
                    "Double": 0.0
                },
                "Mode": {
                    "Type": 3.0,
                    "Integer": 1.0
                },
                "Format": {
                    "Type": 3.0,
                    "Integer": 1.0
                },
                "Decimals": {
                    "Type": 3.0,
                    "Integer": 3.0
                },
                "Prefix": {
                    "Type": 5.0,
                    "String": ""
                },
                "Suffix": {
                    "Type": 5.0,
                    "String": ""
                },
                "ThousandsSep": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "Editable": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "ForeColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 0.0,
                        "Green": 0.0,
                        "Blue": 0.0,
                        "Alpha": 255.0
                    }
                },
                "BackColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 255.0,
                        "Green": 255.0,
                        "Blue": 255.0,
                        "Alpha": 255.0
                    }
                },
                "TabOrder": {
                    "Type": 3.0,
                    "Integer": 3.0
                }
            }
        },
        "Numeric": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "loan_term"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 153.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 57.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 100.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 21.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Value": {
                    "Type": 1.0,
                    "Double": 0.0
                },
                "Mode": {
                    "Type": 3.0,
                    "Integer": 0.0
                },
                "Format": {
                    "Type": 3.0,
                    "Integer": 0.0
                },
                "Decimals": {
                    "Type": 3.0,
                    "Integer": 3.0
                },
                "Prefix": {
                    "Type": 5.0,
                    "String": ""
                },
                "Suffix": {
                    "Type": 5.0,
                    "String": ""
                },
                "ThousandsSep": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "Editable": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "ForeColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 0.0,
                        "Green": 0.0,
                        "Blue": 0.0,
                        "Alpha": 255.0
                    }
                },
                "BackColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 255.0,
                        "Green": 255.0,
                        "Blue": 255.0,
                        "Alpha": 255.0
                    }
                },
                "TabOrder": {
                    "Type": 3.0,
                    "Integer": 2.0
                }
            }
        },
        "Label": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "object 7"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 588.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 90.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 258.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 45.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Caption": {
                    "Type": 5.0,
                    "String": "For a project with no debt, set the debt percent to zero."
                },
                "TextColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 0.0,
                        "Green": 0.0,
                        "Blue": 0.0,
                        "Alpha": 255.0
                    }
                },
                "Bold": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "FontSize": {
                    "Type": 3.0,
                    "Integer": 0.0
                },
                "WordWrap": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "AlignRight": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "AlignTop": {
                    "Type": 2.0,
                    "Boolean": 1.0
                }
            }
        },
        "Numeric": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "ui_loan_amount"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 459.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 57.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 100.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 21.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Value": {
                    "Type": 1.0,
                    "Double": 0.0
                },
                "Mode": {
                    "Type": 3.0,
                    "Integer": 1.0
                },
                "Format": {
                    "Type": 3.0,
                    "Integer": 0.0
                },
                "Decimals": {
                    "Type": 3.0,
                    "Integer": 2.0
                },
                "Prefix": {
                    "Type": 5.0,
                    "String": ""
                },
                "Suffix": {
                    "Type": 5.0,
                    "String": ""
                },
                "ThousandsSep": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "Editable": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "ForeColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 0.0,
                        "Green": 0.0,
                        "Blue": 0.0,
                        "Alpha": 255.0
                    }
                },
                "BackColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 255.0,
                        "Green": 255.0,
                        "Blue": 255.0,
                        "Alpha": 255.0
                    }
                },
                "TabOrder": {
                    "Type": 3.0,
                    "Integer": 4.0
                }
            }
        },
        "Numeric": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "ui_net_capital_cost"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 459.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 33.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 100.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 21.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Value": {
                    "Type": 1.0,
                    "Double": 0.0
                },
                "Mode": {
                    "Type": 3.0,
                    "Integer": 1.0
                },
                "Format": {
                    "Type": 3.0,
                    "Integer": 0.0
                },
                "Decimals": {
                    "Type": 3.0,
                    "Integer": 2.0
                },
                "Prefix": {
                    "Type": 5.0,
                    "String": ""
                },
                "Suffix": {
                    "Type": 5.0,
                    "String": ""
                },
                "ThousandsSep": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "Editable": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "ForeColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 0.0,
                        "Green": 0.0,
                        "Blue": 0.0,
                        "Alpha": 255.0
                    }
                },
                "BackColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 255.0,
                        "Green": 255.0,
                        "Blue": 255.0,
                        "Alpha": 255.0
                    }
                },
                "TabOrder": {
                    "Type": 3.0,
                    "Integer": -1.0
                }
            }
        },
        "Numeric": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "ui_wacc"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 459.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 81.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 100.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 21.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Value": {
                    "Type": 1.0,
                    "Double": 0.0
                },
                "Mode": {
                    "Type": 3.0,
                    "Integer": 1.0
                },
                "Format": {
                    "Type": 3.0,
                    "Integer": 0.0
                },
                "Decimals": {
                    "Type": 3.0,
                    "Integer": 2.0
                },
                "Prefix": {
                    "Type": 5.0,
                    "String": ""
                },
                "Suffix": {
                    "Type": 5.0,
                    "String": ""
                },
                "ThousandsSep": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "Editable": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "ForeColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 0.0,
                        "Green": 0.0,
                        "Blue": 0.0,
                        "Alpha": 255.0
                    }
                },
                "BackColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 255.0,
                        "Green": 255.0,
                        "Blue": 255.0,
                        "Alpha": 255.0
                    }
                },
                "TabOrder": {
                    "Type": 3.0,
                    "Integer": 5.0
                }
            }
        }
    },
    "VarDatabase": {
        "debt_fraction": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Debt percent",
            "Units": "%",
            "Group": "Project Term Debt",
            "IndexLabels": "",
            "Flags": 2.0,
            "DefaultValue": 50.0,
            "UIObject": "Numeric",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "debt_message": {
            "Version": 4.0,
            "Type": 4.0,
            "Label": "Message for debt inputs",
            "Units": " ",
            "Group": "Project Term Debt",
            "IndexLabels": "",
            "Flags": 5.0,
            "DefaultValue": "",
            "UIObject": "MultilineText",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "loan_rate": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Loan rate",
            "Units": "%/year",
            "Group": "Project Term Debt",
            "IndexLabels": "",
            "Flags": 2.0,
            "DefaultValue": 6.0,
            "UIObject": "Numeric",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "loan_term": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Loan term",
            "Units": "years",
            "Group": "Project Term Debt",
            "IndexLabels": "",
            "Flags": 2.0,
            "DefaultValue": 30.0,
            "UIObject": "Numeric",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "ui_loan_amount": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Debt",
            "Units": "$",
            "Group": "Project Term Debt",
            "IndexLabels": "",
            "Flags": 8.0,
            "DefaultValue": 0.0,
            "UIObject": "Numeric",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "ui_net_capital_cost": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Net capital cost",
            "Units": "$",
            "Group": "Project Term Debt",
            "IndexLabels": "",
            "Flags": 8.0,
            "DefaultValue": 0.0,
            "UIObject": "Numeric",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "ui_wacc": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "WACC",
            "Units": "%",
            "Group": "Project Term Debt",
            "IndexLabels": "",
            "Flags": 8.0,
            "DefaultValue": 0.0,
            "UIObject": "Numeric",
            "sscVariableName": "",
            "sscVariableValue": ""
        }
    },
    "Equations": {
        "1": "/*construction financing equations are left over ",
        "2": "from old comppa and ipp model and can be removed*/",
        "3": "equations{ 'ui_net_capital_cost' } = define() {",
        "4": "    ",
        "5": "    cost_installed = ${total_installed_cost};",
        "6": "\tibi = ${ibi_fed_amount} ",
        "7": "\t\t+ ${ibi_sta_amount}",
        "8": "\t\t+ ${ibi_uti_amount}",
        "9": "\t\t+ ${ibi_oth_amount};",
        "10": "\tibi_fed = ${ibi_fed_percent}/100 * cost_installed;",
        "11": "\tibi_fed = min(ibi_fed,${ibi_fed_percent_maxvalue});",
        "12": "\tibi_sta = ${ibi_sta_percent}/100 * cost_installed;",
        "13": "\tibi_sta = min(ibi_sta,${ibi_sta_percent_maxvalue});",
        "14": "\tibi_uti = ${ibi_uti_percent}/100 * cost_installed;",
        "15": "\tibi_uti = min(ibi_uti,${ibi_uti_percent_maxvalue});",
        "16": "\tibi_oth = ${ibi_oth_percent}/100 * cost_installed;",
        "17": "\tibi_oth = min(ibi_oth,${ibi_oth_percent_maxvalue});",
        "18": "\tibi = ibi + ibi_fed + ibi_sta + ibi_uti + ibi_oth;\t",
        "19": "\t",
        "20": "\tcapacity = ${system_capacity}*1000; //kW to W",
        "21": "\tcbi_fed = capacity * ${cbi_fed_amount};",
        "22": "\tcbi_fed = min(cbi_fed,${cbi_fed_maxvalue});",
        "23": "\tcbi_sta = capacity * ${cbi_sta_amount};",
        "24": "\tcbi_sta = min(cbi_sta,${cbi_sta_maxvalue});",
        "25": "\tcbi_uti = capacity * ${cbi_uti_amount};",
        "26": "\tcbi_uti = min(cbi_uti,${cbi_uti_maxvalue});",
        "27": "\tcbi_oth = capacity * ${cbi_oth_amount};",
        "28": "\tcbi_oth = min(cbi_oth,${cbi_oth_maxvalue});",
        "29": "\tcbi = cbi_fed + cbi_sta + cbi_uti + cbi_oth;",
        "30": "\t",
        "31": "\tc = cost_installed - ibi - cbi;\t",
        "32": "\treturn c; ",
        "33": "};",
        "34": "",
        "35": "equations{ 'ui_loan_amount' } = define() {",
        "36": "  fin = financing();",
        "37": "  if ( fin == 'Residential' || fin == 'Commercial' )",
        "38": "\ta = ${ui_net_capital_cost} * ${debt_fraction} / 100;",
        "39": "  else",
        "40": "    a = ( ${ui_net_capital_cost} + ${construction_financing_cost} )",
        "41": "        * ${debt_fraction} / 100;",
        "42": "  return a;",
        "43": "};",
        "44": "",
        "45": "equations{ 'ui_wacc' } = define() {",
        "46": "  return 100 ",
        "47": "    * ( ( (1+${real_discount_rate}/100)",
        "48": "          * (1+${inflation_rate}/100) ",
        "49": "        - 1 )",
        "50": "    * (1-${debt_fraction}/100)",
        "51": "      + (1-(${federal_tax_rate}[0]/100",
        "52": "    * (1-${state_tax_rate}[0]/100)",
        "53": "      + ${state_tax_rate}[0]/100))",
        "54": "    * ${loan_rate}/100",
        "55": "    * ${debt_fraction}/100); ",
        "56": "};",
        "57": "",
        "58": "equations{ 'ui_construction_financing_cost' } = define() {",
        "59": "  fin = financing();",
        "60": "  if ( fin == 'Residential' || fin == 'Commercial' ) c = 0;",
        "61": "  else\tc = ${construction_financing_cost}; ",
        "62": "  return c;",
        "63": "};\t"
    },
    "Callbacks": {
        "1": "// this page is only for commercial model",
        "2": "",
        "3": "on_load{'Financial Debt Min DSCR'} = define() {",
        "4": "\ttxt = debt_messages();",
        "5": "\tproperty('debt_message','caption',txt);",
        "6": "};",
        "7": "",
        "8": "function debt_messages() {",
        "9": "  msg = '';",
        "10": "  ",
        "11": "  fin = financing();",
        "12": "  debt = true;",
        "13": "  if ( fin == 'All Equity Partnership Flip' || fin == 'Sale Leaseback' ) {",
        "14": "    debt = false;",
        "15": "  }",
        "16": "  if ( debt == true ) {",
        "17": "    if ( fin == 'Residential' || fin == 'Commercial' ) {",
        "18": "      if ( value('loan_term') > value('analysis_period') && value('debt_fraction') > 0 ) {",
        "19": "        msg = msg + 'Debt payment period (loan term) is longer than the analysis period. SAM does not account for debt liability beyond the analysis period. ';",
        "20": "      }  ",
        "21": "    }  ",
        "22": "    else {",
        "23": "      ppa_debt = (value('debt_option') == 1 && value('dscr') > 0) || (value('debt_option')==0 && value('debt_percent')) > 0;",
        "24": "      if ( value('term_tenor') > value('analysis_period') && ppa_debt==true ) {",
        "25": "        msg = msg + 'Debt payment period (tenor) is longer than the analysis period. SAM does not account for debt liability beyond the analysis period. ';",
        "26": "      }  ",
        "27": "    }        ",
        "28": "  }",
        "29": "  return msg;  ",
        "30": "}",
        "31": "",
        "32": "on_change{'loan_term'} = define() {",
        "33": "\ttxt = debt_messages();",
        "34": "\tproperty('debt_message','caption',txt);",
        "35": "};",
        "36": ""
    }
}
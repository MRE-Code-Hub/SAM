{
    "Name": "Battery Model",
    "Width": 1052.0,
    "Height": 68.0,
    "FormObjects": {
        "GroupBox": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "Battery Chemistry Group"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 6.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 3.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 1042.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 60.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Caption": {
                    "Type": 5.0,
                    "String": "Chemistry"
                },
                "Bold": {
                    "Type": 2.0,
                    "Boolean": 1.0
                }
            }
        },
        "Choice": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "batt_type"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 153.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 24.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 438.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 24.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Items": {
                    "Type": 6.0,
                    "StringList": "Lead Acid Flooded|Lead Acid VRLA Gel|Lead Acid VRLA AGM|Lead Acid Custom|Lithium-ion Lithium Manganese Oxide (LMO/Graphite)|Lithium-ion Lithium Iron Phosphate (LFP/Graphite)|Lithium-ion Lithium Cobalt Oxide (LCO/Graphite)|Lithium-ion LMO/Lithium Titanate (LMO/LTO)|Lithium-ion Nickel Manganese Cobalt Oxide (NMC/Graphite)|Lithium-ion Nickel Cobalt Aluminum Oxide (NCA/Graphite)|Lithium-ion Custom"
                },
                "Selection": {
                    "Type": 3.0,
                    "Integer": -1.0
                },
                "TabOrder": {
                    "Type": 3.0,
                    "Integer": 1.0
                }
            }
        }
    },
    "VarDatabase": {
        "LeadAcid_q10": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Discharge rate 10-hour",
            "Units": "%",
            "Group": "Battery Chemistry",
            "IndexLabels": "",
            "Flags": 2.0,
            "DefaultValue": 93.0,
            "UIObject": "Default",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "LeadAcid_q10_computed": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Discharge rate 10-hour calculated",
            "Units": "Ah",
            "Group": "Battery Chemistry",
            "IndexLabels": "",
            "Flags": 8.0,
            "DefaultValue": 0.0,
            "UIObject": "Numeric",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "LeadAcid_q20": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Discharge rate 10-hour",
            "Units": "%",
            "Group": "Battery Chemistry",
            "IndexLabels": "",
            "Flags": 2.0,
            "DefaultValue": 100.0,
            "UIObject": "Default",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "LeadAcid_q20_computed": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Discharge rate 10-hour calculated",
            "Units": "Ah",
            "Group": "Battery Chemistry",
            "IndexLabels": "",
            "Flags": 8.0,
            "DefaultValue": 0.0,
            "UIObject": "Numeric",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "LeadAcid_qn": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Capacity at n-hour discharge rate",
            "Units": "%",
            "Group": "Battery Chemistry",
            "IndexLabels": "",
            "Flags": 1.0,
            "DefaultValue": 60.0,
            "UIObject": "Default",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "LeadAcid_qn_computed": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Capacity at n-hour discharge rate calculated",
            "Units": "Ah",
            "Group": "Battery Chemistry",
            "IndexLabels": "",
            "Flags": 8.0,
            "DefaultValue": 0.0,
            "UIObject": "Numeric",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "LeadAcid_tn": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Hours of storage",
            "Units": "hours",
            "Group": "Battery Chemistry",
            "IndexLabels": "",
            "Flags": 1.0,
            "DefaultValue": 1.0,
            "UIObject": "Default",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "batt_Qexp": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Battery capacity exp",
            "Units": "Ah",
            "Group": "Battery Chemistry",
            "IndexLabels": "",
            "Flags": 9.0,
            "DefaultValue": 1.0,
            "UIObject": "Numeric",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "batt_Qnom": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Battery capacity nominal",
            "Units": "Ah",
            "Group": "Battery Chemistry",
            "IndexLabels": "",
            "Flags": 9.0,
            "DefaultValue": 56.0,
            "UIObject": "Numeric",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "batt_chem": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Battery chemistry options",
            "Units": " ",
            "Group": "Battery Chemistry",
            "IndexLabels": "",
            "Flags": 9.0,
            "DefaultValue": 1.0,
            "UIObject": "Default",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "batt_life_model": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Battery life model option",
            "Units": " ",
            "Group": "Battery Chemistry",
            "IndexLabels": "",
            "Flags": 8.0,
            "DefaultValue": 0.0,
            "UIObject": "Default",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "batt_meter_position": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Battery meter position",
            "Units": " ",
            "Group": "Battery Chemistry",
            "IndexLabels": "",
            "Flags": 0.0,
            "DefaultValue": 0.0,
            "UIObject": "Default",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "batt_type": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Battery type",
            "Units": " ",
            "Group": "Battery Chemistry",
            "IndexLabels": "Lead Acid: Flooded|Lead Acid: VRLA Gel|Lead Acid: VRLA AGM|Lead Acid: Custom|Lithium Ion: Lithium Manganese Oxide (LMO/Graphite)|Lithium Ion: Lithium Iron Phosphate (LFP/Graphite)|Lithium Ion: Lithium Cobalt Oxide (LCO/Graphite)|Lithium Ion: LMO/Lithium Titanate (LMO/LTO)|Lithium Ion: Nickel Manganese Cobalt Oxide (NMC/Graphite)|Lithium Ion: Nickel Cobalt Aluminum Oxide (NCA/Graphite)|Lithium Ion: Custom|Flow Battery: Vanadium|Flow Battery: Iron",
            "Flags": 2.0,
            "DefaultValue": 0.0,
            "UIObject": "Choice",
            "sscVariableName": "",
            "sscVariableValue": ""
        }
    },
    "Equations": {
        "1": "equations{ 'batt_chem' } = define(){",
        "2": "\t// lead acid",
        "3": "\tif (${batt_type} <= 3)",
        "4": "\t\treturn 0;",
        "5": "\t// lithium ion",
        "6": "\telse if (${batt_type} <= 10)",
        "7": "\t\treturn 1;",
        "8": "\t// vanadium redox flow",
        "9": "\telse if (${batt_type} == 11)",
        "10": "\t\treturn 2;",
        "11": "\t// iron flow",
        "12": "\telse if (${batt_type} == 12)",
        "13": "\t\treturn 3;",
        "14": "};",
        "15": ""
    },
    "Callbacks": {
        "1": "on_load{'Battery Model'} = define()",
        "2": "{",
        "3": "\tset_chemistry();",
        "4": "\tset_meter_position();",
        "5": "\tbattsize_warning_check();",
        "6": "};",
        "7": "",
        "8": "on_change{'batt_type'} = define()",
        "9": "{",
        "10": "\ttype = value('batt_type');",
        "11": "\t",
        "12": "\tif (type != 3 && type != 10)",
        "13": "\t\t{ update_default = yesno('Battery Type Change\\nReplace inputs with default values for this battery type?'); }",
        "14": "\telse",
        "15": "\t\t{ update_default = false; }",
        "16": "\t",
        "17": "\tislead = (value('batt_chem') == 0);",
        "18": "\tislithium = (value('batt_chem') == 1);",
        "19": "\tisvanadium = (value('batt_chem') == 2);",
        "20": "\tisiron = (value('batt_chem') == 3);",
        "21": "\tset_chemistry();",
        "22": "\t",
        "23": "\t// call to other script (Battery Bank Sizing)",
        "24": "\tset_bank_sizing();",
        "25": "\t",
        "26": "\t// call to other script (Battery Voltage)",
        "27": "\tset_voltage_choice(update_default);",
        "28": "\t",
        "29": "\t// call to other script (Battery Current and Capacity)",
        "30": "\tset_current_and_capacity();",
        "31": "\t",
        "32": "\t// lead acid",
        "33": "\tif (islead)",
        "34": "\t\t{ set_lead_acid(update_default); }",
        "35": "\t// Lithium Ion",
        "36": "\telse if (islithium)",
        "37": "\t\t{ set_lithium_ion(update_default); }",
        "38": "\t// Vanadium Redox FLow",
        "39": "\telse if (isvanadium)",
        "40": "\t\t{ set_vanadium(update_default); }",
        "41": "\t// Iron Flow",
        "42": "\telse if (isiron)",
        "43": "\t\t{ set_iron(update_default); }",
        "44": "",
        "45": "\tbattsize_warning_check();",
        "46": "",
        "47": "\t// Update inputs on Battery Life Options form",
        "48": "\tvalue('ui_batt_life_model', ${batt_life_model});",
        "49": "\tif (technology() != 'Fuel Cell' )",
        "50": "\t{",
        "51": "\t\tset_batt_life_excl_var();",
        "52": "\t}\t",
        "53": "",
        "54": "};",
        "55": "",
        "56": "function is_flow()",
        "57": "{",
        "58": "\tflow = false;",
        "59": "\tif (value('batt_chem') == 2 || value('batt_chem') == 3)",
        "60": "\t\tflow = true;",
        "61": "\treturn flow;",
        "62": "}",
        "63": "",
        "64": "function set_flow()",
        "65": "{",
        "66": "\tshow('batt_bank_nseries_stacks', true);",
        "67": "\tproperty('batt_size_choice', 'Items', ['Set desired bank size', 'Specify capacity and stack configuration']); ",
        "68": "\tproperty('batt_series_label', 'Caption', 'Number of cells per stack');",
        "69": "\tproperty('batt_parallel_label', 'Caption', 'Number of parallel stacks');",
        "70": "\tproperty('batt_computed_parallel_label', 'Caption', 'Stacks in parallel');",
        "71": "\tproperty('batt_computed_cells_series_label', 'Caption', 'Cells per stack');",
        "72": "}\t",
        "73": "function set_conventional()",
        "74": "{",
        "75": "\tshow('batt_bank_nseries_stacks', false);",
        "76": "\tproperty('batt_size_choice', 'Items', ['Set desired bank size', 'Specify cells']); ",
        "77": "\tproperty('batt_series_label', 'Caption', 'Number of cells in series');",
        "78": "\tproperty('batt_parallel_label', 'Caption', 'Number of strings in parallel');",
        "79": "\tproperty('batt_computed_parallel_label', 'Caption', 'Strings in parallel');",
        "80": "\tproperty('batt_computed_cells_series_label', 'Caption', 'Cells in series');",
        "81": "}",
        "82": "",
        "83": "function set_chemistry()",
        "84": "{",
        "85": "\tis_lead = (value('batt_chem') == 0);",
        "86": "\tenable('LeadAcid_q20',is_lead);",
        "87": "\tenable('LeadAcid_q20_computed',is_lead);",
        "88": "\tenable('LeadAcid_q10',is_lead);",
        "89": "\tenable('LeadAcid_q10_computed',is_lead);",
        "90": "\tenable('LeadAcid_qn',is_lead);",
        "91": "\tenable('LeadAcid_qn_computed',is_lead);",
        "92": "\t",
        "93": "\t// set widget properties",
        "94": "\tif (is_flow())",
        "95": "\t\tset_flow();",
        "96": "\telse",
        "97": "\t\tset_conventional();",
        "98": "}",
        "99": "",
        "100": "function set_meter_position()",
        "101": "{",
        "102": "\tf = financing();",
        "103": "\tif ( !strcmp(f, 'Residential') ",
        "104": "\t|| !strcmp(f, 'Commercial')",
        "105": "\t|| !strcmp(f, 'Third Party')",
        "106": "\t|| !strcmp(f, 'Host Developer') )",
        "107": "\t{\t",
        "108": "\t\t// behind the meter",
        "109": "\t\t${batt_meter_position} = 0;\t",
        "110": "\t}",
        "111": "\telseif (f == 'Single Owner' ",
        "112": "\t|| f == 'Merchant Plant'",
        "113": "\t|| f == 'Leveraged Partnership Flip'",
        "114": "\t|| f == 'All Equity Partnership Flip'",
        "115": "\t|| f == 'Sale Leaseback' )",
        "116": "\t{",
        "117": "\t\t// in front of the meter",
        "118": "\t\t${batt_meter_position} = 1;\t",
        "119": "\t}",
        "120": "}",
        "121": "function set_lead_acid(update_default)",
        "122": "{",
        "123": "\tlead_type = ${batt_type};",
        "124": "\t",
        "125": "\tif (update_default)",
        "126": "\t{\t",
        "127": "\t\t// flooded lead acid",
        "128": "\t\tif (lead_type == 0)",
        "129": "\t\t\tflooded_lead_acid();",
        "130": "\t\telse if (lead_type == 1)",
        "131": "\t\t\tGEL();",
        "132": "\t\telse if (lead_type == 2)",
        "133": "\t\t\tAGM();",
        "134": "\t\t\t",
        "135": "\t\tlead_acid_defaults();\t",
        "136": "\t}",
        "137": "}",
        "138": "function set_lithium_ion(update_default)",
        "139": "{",
        "140": "\tlithium_type = ${batt_type}-4;",
        "141": "\t",
        "142": "\tif (update_default)",
        "143": "\t{",
        "144": "\t\tlithium_ion_defaults();",
        "145": "\t\tif (lithium_type == 0)",
        "146": "\t\t\tLMO();",
        "147": "\t\telse if (lithium_type == 1)",
        "148": "\t\t\tLFP();",
        "149": "\t\telse if (lithium_type == 2)",
        "150": "\t\t\tLCO();",
        "151": "\t\telse if (lithium_type == 3)",
        "152": "\t\t\tLTO();",
        "153": "\t\telse if (lithium_type == 4)",
        "154": "\t\t\tNMC();",
        "155": "\t\telse if (lithium_type == 5)",
        "156": "\t\t\tNCA();",
        "157": "\t}",
        "158": "\tif (financing() == 'Residential')",
        "159": "\t\tvalue('batt_bank_voltage', 50);",
        "160": "\telse",
        "161": "\t\tvalue('batt_bank_voltage', 500);",
        "162": "}",
        "163": "function set_vanadium(update_default)",
        "164": "{",
        "165": "\tif (update_default)",
        "166": "\t{",
        "167": "\t\tif (${batt_type} == 11)",
        "168": "\t\t\t{ VRFB(); }",
        "169": "\t}",
        "170": "}",
        "171": "function set_iron(update_default)",
        "172": "{",
        "173": "\t// don't allow iron flow to use voltage model ever",
        "174": "\tvalue('batt_voltage_choice', 1);",
        "175": "\tif (update_default)",
        "176": "\t{",
        "177": "\t\tif (${batt_type} == 12)",
        "178": "\t\t\tIronFlow();",
        "179": "\t}",
        "180": "}",
        "181": "",
        "182": "// Flooded Lead Acid defaults",
        "183": "function flooded_lead_acid()",
        "184": "{",
        "185": "\tvalue('batt_specific_energy_per_mass',50); ",
        "186": "\tvalue('batt_specific_energy_per_volume',98);",
        "187": "}",
        "188": "",
        "189": "// AGM defaults",
        "190": "function AGM()",
        "191": "{",
        "192": "\tvalue('batt_specific_energy_per_mass',35); ",
        "193": "\tvalue('batt_specific_energy_per_volume',80);",
        "194": "}",
        "195": "// GEL defaults",
        "196": "function GEL()",
        "197": "{",
        "198": "\tvalue('batt_specific_energy_per_mass',35); ",
        "199": "\tvalue('batt_specific_energy_per_volume',75);",
        "200": "}",
        "201": "",
        "202": "function get_batt_data_from_file(filename)",
        "203": "{",
        "204": "\tdefaults_dir = replace(appdir(), '\\\\', '/' ) + '/../libraries/BatteryStateful/';",
        "205": "\tdefaults_dir += filename;",
        "206": "\tx = read_json(defaults_dir);",
        "207": "\tdefs = x.defaults;",
        "208": "\tset_batt_defaults_from_data(defs);",
        "209": "}",
        "210": "",
        "211": "function set_batt_defaults_from_data(defs)",
        "212": "{",
        "213": "\tcell_params = defs.paramscell;",
        "214": "\tpack_params = defs.paramspack;",
        "215": "\t",
        "216": "\tvalue('batt_Qfull',cell_params.qfull);",
        "217": "\tvalue('batt_Vnom_default', cell_params.vnom_default);",
        "218": "\t\t",
        "219": "\tif (value('batt_chem') == 0) {",
        "220": "\t\tvalue('LeadAcid_q20',cell_params.leadacid_q20);",
        "221": "\t\tvalue('LeadAcid_q10',cell_params.leadacid_q10);",
        "222": "\t\tvalue('LeadAcid_qn',cell_params.leadacid_qn);",
        "223": "\t\tvalue('LeadAcid_tn',cell_params.leadacid_tn);",
        "224": "\t}",
        "225": "\t",
        "226": "\tif (cell_params.voltage_choice == 0) {",
        "227": "\t\t// voltage curve",
        "228": "\t\tvalue('batt_C_rate',cell_params.c_rate);",
        "229": "\t\tvalue('batt_Vfull',cell_params.vfull);",
        "230": "\t\tvalue('batt_Vexp',cell_params.vexp);",
        "231": "\t\tvalue('batt_Vnom',cell_params.vnom);",
        "232": "\t\tvalue('batt_Vcut',cell_params.vcut);",
        "233": "\t\tvalue('batt_Qexp',cell_params.qexp);",
        "234": "\t\tvalue('batt_Vnom',cell_params.vnom);",
        "235": "\t\t${batt_Qexp_percent} = ${batt_Qexp}/${batt_Qfull}/0.01;",
        "236": "\t\t${batt_Qnom_percent} = cell_params.qnom/${batt_Qfull}/0.01;",
        "237": "\t}",
        "238": "\telse {",
        "239": "\t\tvalue('batt_voltage_matrix', cell_params.voltage_matrix);",
        "240": "\t}",
        "241": "\t",
        "242": "\tvalue('batt_resistance', cell_params.resistance); // from UBGC2, and DC400-6",
        "243": "\tvalue('batt_voltage_choice', cell_params.voltage_choice);",
        "244": "",
        "245": "  \tvalue('batt_bank_voltage', pack_params.nominal_voltage);",
        "246": "  \t",
        "247": "\t// Lifetime",
        "248": "\tvalue('batt_life_model', cell_params.life_model);",
        "249": "\tvalue('ui_batt_life_model', ${batt_life_model});",
        "250": "\tvalue('batt_lifetime_matrix',cell_params.cycling_matrix);",
        "251": "\t",
        "252": "\t// turn calendar life model off",
        "253": "\tvalue('batt_calendar_choice', cell_params.calendar_choice);",
        "254": "\t",
        "255": "\t// Thermal",
        "256": "\tvalue('cap_vs_temp', pack_params.cap_vs_temp);",
        "257": "\tvalue('batt_Cp',pack_params.cp);",
        "258": "\t",
        "259": "\t// ancillary system losses",
        "260": "\tzero_array = fill_by_month(0);",
        "261": "\tvalue('batt_losses_charging', zero_array);",
        "262": "\tvalue('batt_losses_discharging', zero_array);",
        "263": "\tvalue('batt_losses_idle', zero_array);",
        "264": "",
        "265": "}",
        "266": "",
        "267": "// Valve Regulated Lead Acid defaults",
        "268": "function lead_acid_defaults()",
        "269": "{",
        "270": "\tConversionEfficiencies();",
        "271": "\tget_batt_data_from_file('BatteryStateful_LeadAcid.json');",
        "272": "}",
        "273": "",
        "274": "// Lithium Manganese Oxide / Graphite",
        "275": "function LMO()",
        "276": "{",
        "277": "\t// voltage curve",
        "278": "\tvalue('batt_C_rate',1);",
        "279": "\tvalue('batt_Vfull',4.2);",
        "280": "\tvalue('batt_Vexp',4.1);",
        "281": "\tvalue('batt_Vnom',3.6);",
        "282": "\tvalue('batt_Vcut',2.772);",
        "283": "\tvalue('batt_Qfull',1.5);",
        "284": "\tvalue('batt_Qexp_percent',0.666);",
        "285": "\tvalue('batt_Qnom_percent',93.33);",
        "286": "\tvalue('batt_Vnom_default',3.6);",
        "287": "\tvalue('batt_specific_energy_per_mass',92.5);",
        "288": "\tvalue('batt_specific_energy_per_volume',231.97);",
        "289": "\t\t",
        "290": "\t// Lifetime",
        "291": "\tlifetime = [[20,0,100],",
        "292": "\t\t\t\t[20, 2500, 92], ",
        "293": "\t\t\t\t[20,5000,84], ",
        "294": "\t\t\t\t[80,0,100],",
        "295": "\t\t\t\t[80, 500, 92], ",
        "296": "\t\t\t\t[80,1000,84] ];",
        "297": "\tvalue('batt_lifetime_matrix',lifetime);",
        "298": "\tvalue('batt_life_model', 0);",
        "299": "}",
        "300": "// Lithium Iron Phospate / Graphite",
        "301": "function LFP()",
        "302": "{",
        "303": "\tget_batt_data_from_file('BatteryStateful_LFPGraphite.json');",
        "304": "\t",
        "305": "\tvalue('batt_specific_energy_per_mass',70);",
        "306": "\tvalue('batt_specific_energy_per_volume',82);",
        "307": "}",
        "308": "// Lithium Cobalt Oxide / Graphite",
        "309": "function LCO()",
        "310": "{",
        "311": "\t// voltage curve",
        "312": "\tvalue('batt_C_rate',0.2);",
        "313": "\tvalue('batt_Vfull',4.2);",
        "314": "\tvalue('batt_Vexp',4.15);",
        "315": "\tvalue('batt_Vnom',3.7);",
        "316": "\tvalue('batt_Vcut',2.772);",
        "317": "\tvalue('batt_Qfull',2.55);",
        "318": "\tvalue('batt_Qexp_percent',0.40);",
        "319": "\tvalue('batt_Qnom_percent',78.4);",
        "320": "\tvalue('batt_Vnom_default',3.7);",
        "321": "\tvalue('batt_specific_energy_per_mass',176.95);",
        "322": "\tvalue('batt_specific_energy_per_volume',363.79);",
        "323": "\t\t",
        "324": "\t// Lifetime",
        "325": "\tlifetime = [ [20,0,100],",
        "326": "\t\t\t\t [20,650,98],",
        "327": "\t\t\t\t [20,1500,95],",
        "328": "\t\t\t\t [80,0,102],",
        "329": "\t\t\t\t [80,150,93],",
        "330": "\t\t\t\t [80,300,87] ];",
        "331": "\tvalue('batt_lifetime_matrix',lifetime);",
        "332": "\tvalue('batt_life_model', 0);",
        "333": "}",
        "334": "// Lithium Manganese Oxide / Lithium Titanate Oxide",
        "335": "function LTO()",
        "336": "{",
        "337": "\tget_batt_data_from_file('BatteryStateful_LMOLTO.json');",
        "338": "\t",
        "339": "\tvalue('batt_specific_energy_per_mass',22);",
        "340": "\tvalue('batt_specific_energy_per_volume',14);",
        "341": "}",
        "342": "",
        "343": "// Lithium Nickel Manganese Cobalt Oxide / Graphite",
        "344": "function NMC()",
        "345": "{",
        "346": "\tget_batt_data_from_file('BatteryStateful_NMCGraphite.json');",
        "347": "\t",
        "348": "\tvalue('batt_specific_energy_per_mass',101);",
        "349": "\tvalue('batt_specific_energy_per_volume',70);",
        "350": "}",
        "351": "",
        "352": "// Lithium Nickel Cobalt Aluminum Oxide / Graphite",
        "353": "function NCA()",
        "354": "{",
        "355": "\t// voltage curve",
        "356": "\tvalue('batt_Vnom_default',3.6);",
        "357": "\tvalue('batt_C_rate',0.2);",
        "358": "\tvalue('batt_Vfull',4.2);",
        "359": "\tvalue('batt_Vexp',4.1);",
        "360": "\tvalue('batt_Vnom',3.6);",
        "361": "\tvalue('batt_Vcut',2.772);",
        "362": "\tvalue('batt_Qfull',55);",
        "363": "\tvalue('batt_Qexp_percent',1.8);",
        "364": "\tvalue('batt_Qnom_percent',98.2);",
        "365": "\tvalue('batt_specific_energy_per_mass',202.90);",
        "366": "\tvalue('batt_specific_energy_per_volume',532.58);",
        "367": "\t\t",
        "368": "\t// Lifetime",
        "369": "\tlifetime = [ [20,0,100],",
        "370": "\t\t\t\t [20,5000,80],",
        "371": "\t\t\t\t [20,10000,60],",
        "372": "\t\t\t\t [80,0,100],",
        "373": "\t\t\t\t [80,1000,80],",
        "374": "\t\t\t\t [80,2000,60]];",
        "375": "\tvalue('batt_lifetime_matrix',lifetime);",
        "376": "\tvalue('batt_life_model', 0);",
        "377": "}",
        "378": "",
        "379": "function lithium_ion_defaults()",
        "380": "{",
        "381": "",
        "382": "\tConversionEfficiencies();",
        "383": "",
        "384": "\t// Can be overwritten by chemistry-specific fx",
        "385": "\tcap_vs_temp = [[-20, 72.33333333],",
        "386": "\t\t\t\t\t[-10, 81.8],",
        "387": "\t\t\t\t\t[0, 88.8],",
        "388": "\t\t\t\t\t[10, 93],",
        "389": "\t\t\t\t\t[23, 96.66666667],",
        "390": "\t\t\t\t\t[45, 101],",
        "391": "\t\t\t\t\t[60, 101]];",
        "392": "\tvalue('cap_vs_temp', cap_vs_temp);",
        "393": "",
        "394": "\t// Maleki 1999 Thermal Properties of Lithium-Ion Battery & Components",
        "395": "\tvalue('batt_Cp',1500);",
        "396": "\t",
        "397": "\t// turn on calendar lifetime model",
        "398": "\tvalue('batt_calendar_choice', 1);",
        "399": "\t",
        "400": "\t// use voltage model not matrix",
        "401": "\tvalue('batt_voltage_choice', 0);",
        "402": "}",
        "403": "// Vanadium Redox Flow Battery",
        "404": "function VRFB()",
        "405": "{",
        "406": "\tFlowDefaults();",
        "407": "",
        "408": "\t// voltage curve",
        "409": "\tvalue('batt_Vnom_default',1.4);",
        "410": "\tvalue('batt_C_rate',0.2);",
        "411": "\tvalue('batt_Vfull',1.7);",
        "412": "\tvalue('batt_Vexp',1.55);",
        "413": "\tvalue('batt_Vnom',1.4);",
        "414": "\tvalue('batt_Qfull',397);",
        "415": "\tvalue('batt_Qexp_percent',10);",
        "416": "\tvalue('batt_Qnom_percent',85);",
        "417": "",
        "418": "\tvalue('batt_voltage_choice', 0);",
        "419": "\tvoltage_matrix = [[0,0]];",
        "420": "  \tvalue('batt_voltage_matrix', voltage_matrix);",
        "421": "",
        "422": "\t// dispatch control",
        "423": "\tvalue('batt_minimum_SOC', 15);",
        "424": "\tvalue('batt_maximum_SOC', 95);",
        "425": "\tvalue('batt_minimum_modetime', 10);",
        "426": "",
        "427": "\t// thermal properties ",
        "428": "\t// (from 2016 - Yan, Modelling and simulation of thermal behavior of vanadium redox flow battery)",
        "429": "\tvalue('batt_Cp', 3200);",
        "430": "",
        "431": "\t// turn calendar life model off",
        "432": "\tvalue('batt_calendar_choice', 0);",
        "433": "\t",
        "434": "}",
        "435": "// Iron flow battery",
        "436": "function IronFlow()",
        "437": "{",
        "438": "\tFlowDefaults();",
        "439": "",
        "440": "\tvoltage_matrix = [[0, 1.18],",
        "441": "\t\t\t\t  [20, 1.11],",
        "442": "\t\t\t\t  [40, 1.08],",
        "443": "\t\t\t\t  [60, 1.05],",
        "444": "\t\t\t\t  [80, 1.02],",
        "445": "\t\t\t\t  [100, 0.95]];",
        "446": "",
        "447": "\t// voltage curve",
        "448": "\tvalue('batt_Vnom_default',1.1);",
        "449": "\tvalue('batt_voltage_matrix', voltage_matrix);",
        "450": "\tvalue('batt_voltage_choice', 1);",
        "451": "",
        "452": "\t// dispatch control",
        "453": "\tvalue('batt_minimum_SOC', 0);",
        "454": "\tvalue('batt_maximum_SOC', 100);",
        "455": "\tvalue('batt_minimum_modetime', 0);",
        "456": "",
        "457": "\t// thermal properties",
        "458": "\tvalue('batt_Cp', 3200); // unknown what this actually is",
        "459": "\t\t\t",
        "460": "\t// turn calendar life model off",
        "461": "\tvalue('batt_calendar_choice', 0);",
        "462": "}",
        "463": "",
        "464": "function FlowDefaults()",
        "465": "{",
        "466": "\tConversionEfficiencies();",
        "467": "\t",
        "468": "\tvalue('batt_resistance', 0.001);",
        "469": "",
        "470": "\t// desired bank voltage",
        "471": "\tvalue('batt_bank_voltage', 48);",
        "472": "\t",
        "473": "\t// current control",
        "474": "\tvalue('batt_current_choice', 0);",
        "475": "\tvalue('batt_cell_power_discharge_max', 200);",
        "476": "\tvalue('batt_cell_power_charge_max', 200);",
        "477": "\t",
        "478": "\t// ancilliary system losses",
        "479": "\tvalue('batt_losses_charging', fill_by_month(0));",
        "480": "\tvalue('batt_losses_discharging', fill_by_month(0));",
        "481": "\tvalue('batt_losses_idle', fill_by_month(0));",
        "482": "\t",
        "483": "\t// Lifetime",
        "484": "\tlifetime = [ [20,0,100],",
        "485": "\t\t\t\t [20,20000,100],",
        "486": "\t\t\t\t [80,0,100],",
        "487": "\t\t\t\t [80,20000,100]];",
        "488": "\tvalue('batt_lifetime_matrix',lifetime);",
        "489": "\t",
        "490": "\t// Thermal",
        "491": "\tcap_vs_temp = [ [19, 100], [21, 100] ];",
        "492": "\tvalue('cap_vs_temp', cap_vs_temp);",
        "493": "\t",
        "494": "\t// thermal",
        "495": "\tvalue('batt_specific_energy_per_mass',20);",
        "496": "\tvalue('batt_specific_energy_per_volume',20);",
        "497": "}",
        "498": "",
        "499": "function ConversionEfficiencies()",
        "500": "{",
        "501": "\tvalue('batt_ac_dc_efficiency', 96);",
        "502": "\tvalue('batt_dc_ac_efficiency', 96);",
        "503": "\tvalue('batt_dc_dc_efficiency', 99);",
        "504": "}",
        "505": "",
        "506": "function fill_by_month(num)",
        "507": "{",
        "508": "\tmonth_array = [];",
        "509": "\tfor (m = 0; m != 12; m++)",
        "510": "\t\tmonth_array[m] = num;",
        "511": "\treturn month_array;",
        "512": "}"
    }
}
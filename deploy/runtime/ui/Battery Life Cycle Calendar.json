{
    "Name": "Battery Life Cycle Calendar",
    "Width": 1054.0,
    "Height": 683.0,
    "FormObjects": {
        "GroupBox": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": ""
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 6.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 3.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 1042.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 672.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Caption": {
                    "Type": 5.0,
                    "String": "Cycle and Calendar Degradation"
                },
                "Bold": {
                    "Type": 2.0,
                    "Boolean": 1.0
                }
            }
        },
        "RadioChoice": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "batt_calendar_choice"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 39.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 387.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 156.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 75.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Selection": {
                    "Type": 3.0,
                    "Integer": 0.0
                },
                "Items": {
                    "Type": 6.0,
                    "StringList": "No calendar degradation|Empirical|Custom"
                },
                "ShowCaptions": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "Horizontal": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "TabOrder": {
                    "Type": 3.0,
                    "Integer": 1.0
                }
            }
        },
        "Plot": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "batt_calendar_life_plot"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 555.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 378.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 400.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 250.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                }
            }
        },
        "Divider": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "batt_calendar_lifetime_label"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 21.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 360.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 966.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 22.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Orientation": {
                    "Type": 3.0,
                    "Integer": 0.0
                },
                "Colour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 120.0,
                        "Green": 120.0,
                        "Blue": 120.0,
                        "Alpha": 255.0
                    }
                },
                "Caption": {
                    "Type": 5.0,
                    "String": "Calendar Degradation"
                },
                "Bold": {
                    "Type": 2.0,
                    "Boolean": 1.0
                }
            }
        },
        "DataMatrix": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "batt_calendar_lifetime_matrix"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 51.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 468.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 450.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 194.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "PasteAppendRows": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "PasteAppendCols": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "ShowButtons": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "ShowRows": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "ShowRowLabels": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "RowLabels": {
                    "Type": 5.0,
                    "String": ""
                },
                "ShadeR0C0": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "VerticalLabel": {
                    "Type": 5.0,
                    "String": ""
                },
                "HorizontalLabel": {
                    "Type": 5.0,
                    "String": ""
                },
                "ShadeC0": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "ShowCols": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "ShowColLabels": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "ColLabels": {
                    "Type": 5.0,
                    "String": "Battery age (days),Capacity (%)"
                },
                "NumRowsLabel": {
                    "Type": 5.0,
                    "String": "Rows:"
                },
                "NumColsLabel": {
                    "Type": 5.0,
                    "String": "Cols:"
                },
                "Layout": {
                    "Type": 3.0,
                    "Integer": 1.0
                },
                "ChoiceColumn": {
                    "Type": 3.0,
                    "Integer": -1.0
                },
                "Choices": {
                    "Type": 5.0,
                    "String": "Choice1,Choice2"
                },
                "HideColumn": {
                    "Type": 3.0,
                    "Integer": -1.0
                },
                "ShowColumn": {
                    "Type": 3.0,
                    "Integer": -1.0
                },
                "ColorMap": {
                    "Type": 2.0,
                    "Boolean": 0.0
                }
            }
        },
        "Divider": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "batt_cycle_lifetime_label"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 12.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 78.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 966.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 22.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Orientation": {
                    "Type": 3.0,
                    "Integer": 0.0
                },
                "Colour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 120.0,
                        "Green": 120.0,
                        "Blue": 120.0,
                        "Alpha": 255.0
                    }
                },
                "Caption": {
                    "Type": 5.0,
                    "String": "Cycle Degradation"
                },
                "Bold": {
                    "Type": 2.0,
                    "Boolean": 1.0
                }
            }
        },
        "DataMatrix": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "batt_lifetime_matrix"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 33.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 99.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 450.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 200.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "PasteAppendRows": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "PasteAppendCols": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "ShowButtons": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "ShowRows": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "ShowRowLabels": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "RowLabels": {
                    "Type": 5.0,
                    "String": ""
                },
                "ShadeR0C0": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "VerticalLabel": {
                    "Type": 5.0,
                    "String": ""
                },
                "HorizontalLabel": {
                    "Type": 5.0,
                    "String": ""
                },
                "ShadeC0": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "ShowCols": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "ShowColLabels": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "ColLabels": {
                    "Type": 5.0,
                    "String": "Depth-of-discharge (%),Cycles Elapsed, Capacity (%)"
                },
                "NumRowsLabel": {
                    "Type": 5.0,
                    "String": "Rows:"
                },
                "NumColsLabel": {
                    "Type": 5.0,
                    "String": "Cols:"
                },
                "Layout": {
                    "Type": 3.0,
                    "Integer": 1.0
                },
                "ChoiceColumn": {
                    "Type": 3.0,
                    "Integer": -1.0
                },
                "Choices": {
                    "Type": 5.0,
                    "String": "Choice1,Choice2"
                },
                "HideColumn": {
                    "Type": 3.0,
                    "Integer": -1.0
                },
                "ShowColumn": {
                    "Type": 3.0,
                    "Integer": -1.0
                },
                "ColorMap": {
                    "Type": 2.0,
                    "Boolean": 0.0
                }
            }
        },
        "Label": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "lbl_cycle_calendar"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 15.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 24.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 990.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 48.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Caption": {
                    "Type": 5.0,
                    "String": "Use the options and tables below to define cycle degradation and calendar degradation curves. SAM automatically updates these inputs when you choose a battery type on the Battery Cell and System page. The empirical calendar degradation model is suitable for Lithium-ion batteries. See help for details."
                },
                "TextColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 0.0,
                        "Green": 0.0,
                        "Blue": 0.0,
                        "Alpha": 255.0
                    }
                },
                "Bold": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "FontSize": {
                    "Type": 3.0,
                    "Integer": 0.0
                },
                "WordWrap": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "AlignRight": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "AlignTop": {
                    "Type": 2.0,
                    "Boolean": 1.0
                }
            }
        },
        "Label": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "lbl_empirical_equation1"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 201.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 387.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 249.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 24.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Caption": {
                    "Type": 5.0,
                    "String": ""
                },
                "TextColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 0.0,
                        "Green": 0.0,
                        "Blue": 0.0,
                        "Alpha": 255.0
                    }
                },
                "Bold": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "FontSize": {
                    "Type": 3.0,
                    "Integer": 0.0
                },
                "WordWrap": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "AlignRight": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "AlignTop": {
                    "Type": 2.0,
                    "Boolean": 0.0
                }
            }
        },
        "Label": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "lbl_empirical_equation2"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 201.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 411.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 342.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 24.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Caption": {
                    "Type": 5.0,
                    "String": ""
                },
                "TextColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 0.0,
                        "Green": 0.0,
                        "Blue": 0.0,
                        "Alpha": 255.0
                    }
                },
                "Bold": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "FontSize": {
                    "Type": 3.0,
                    "Integer": 0.0
                },
                "WordWrap": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "AlignRight": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "AlignTop": {
                    "Type": 2.0,
                    "Boolean": 0.0
                }
            }
        },
        "Plot": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "plot_cap_vs_cycle"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 555.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 99.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 400.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 250.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                }
            }
        }
    },
    "VarDatabase": {
        "batt_calendar_a": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Battery empirical calendar life parameter a",
            "Units": "1/sqrt(day)",
            "Group": "Battery Life",
            "IndexLabels": "",
            "Flags": 2.0,
            "DefaultValue": 0.00266,
            "UIObject": "Numeric",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "batt_calendar_b": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Battery empirical calendar life parameter b",
            "Units": "K",
            "Group": "Battery Life",
            "IndexLabels": "",
            "Flags": 2.0,
            "DefaultValue": -7280.0,
            "UIObject": "Numeric",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "batt_calendar_c": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Battery empirical calendar life parameter c",
            "Units": "K",
            "Group": "Battery Life",
            "IndexLabels": "",
            "Flags": 2.0,
            "DefaultValue": 930.0,
            "UIObject": "Numeric",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "batt_calendar_choice": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Calendar degradation options",
            "Units": " ",
            "Group": "Battery Life",
            "IndexLabels": "None|Empirical|Custom",
            "Flags": 3.0,
            "DefaultValue": 0.0,
            "UIObject": "RadioChoice",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "batt_calendar_lifetime_matrix": {
            "Version": 4.0,
            "Type": 3.0,
            "Label": "Calendar lifetime matrix",
            "Units": " ",
            "Group": "Battery Life",
            "IndexLabels": "",
            "Flags": 3.0,
            "DefaultValue": [
                [
                    0.0,
                    100.0
                ],
                [
                    3650.0,
                    80.0
                ],
                [
                    7300.0,
                    50.0
                ]
            ],
            "UIObject": "DataMatrix",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "batt_calendar_q0": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Battery empirical calendar life parameter q0",
            "Units": "fraction",
            "Group": "Battery Life",
            "IndexLabels": "",
            "Flags": 0.0,
            "DefaultValue": 1.02,
            "UIObject": "Numeric",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "batt_lifetime_matrix": {
            "Version": 4.0,
            "Type": 3.0,
            "Label": "Lifetime matrix",
            "Units": " ",
            "Group": "Battery Life",
            "IndexLabels": "",
            "Flags": 3.0,
            "DefaultValue": [
                [
                    30.0,
                    0.0,
                    100.0
                ],
                [
                    30.0,
                    1100.0,
                    90.0
                ],
                [
                    30.0,
                    1200.0,
                    50.0
                ],
                [
                    50.0,
                    0.0,
                    100.0
                ],
                [
                    50.0,
                    400.0,
                    90.0
                ],
                [
                    50.0,
                    500.0,
                    50.0
                ],
                [
                    100.0,
                    0.0,
                    100.0
                ],
                [
                    100.0,
                    100.0,
                    90.0
                ],
                [
                    100.0,
                    150.0,
                    50.0
                ]
            ],
            "UIObject": "DataMatrix",
            "sscVariableName": "",
            "sscVariableValue": ""
        }
    },
    "Equations": {
        "1": "// Set these values because users are unlikely to have this data",
        "2": "// q = q0 - k_cal * sqrt(t)",
        "3": "// k_cal = a * exp[b(1/T - 1/296)] * exp[c(SOC/T - 1/296)]",
        "4": "equations{'batt_calendar_q0'} = define() { return 1.02; };",
        "5": "equations{'batt_calendar_a'} = define() { return 0.00266; }; // 1/sqrt(day)",
        "6": "equations{'batt_calendar_b'} = define() { return -7280; }; // K",
        "7": "equations{'batt_calendar_c'} = define() { return 939; }; // K",
        "8": ""
    },
    "Callbacks": {
        "1": "on_load{'Battery Life Cycle Calendar'} = define() {",
        "2": "\ton_change{'batt_lifetime_matrix'}(); ",
        "3": "\ton_change{'batt_calendar_choice'}();",
        "4": "\ton_change{'batt_calendar_lifetime_matrix'}();",
        "5": "\tcycle_calendar_message();",
        "6": "\tvalue('batt_life_model',0);",
        "7": "};",
        "8": "",
        "9": "on_change{'batt_calendar_lifetime_matrix'} = define(){",
        "10": "\tplot_calendar_life();",
        "11": "};",
        "12": "",
        "13": "on_change{'batt_calendar_choice'} = define(){",
        "14": "",
        "15": "\tbattery_type_message();",
        "16": "\t",
        "17": "\t// calendar degradation with lead acid or flow batteries may cause SSC error",
        "18": "\tif (${batt_calendar_choice} != 0 && ${batt_chem} !=1)",
        "19": "\t{",
        "20": "\t\tx = yesno('Calendar Degradation\\nThe Empirical degradation model is designed for Li-ion batteries, not Lead-acid or Flow batteries.\\n\\nDo you want to use it anyway?');",
        "21": "\t\tif ( !x )",
        "22": "\t\t{",
        "23": "\t\t\tvalue('batt_calendar_choice', 0);",
        "24": "\t\t\treturn;",
        "25": "\t\t}\t",
        "26": "\t}",
        "27": "\t",
        "28": "\tshow('batt_calendar_lifetime_matrix', ${batt_calendar_choice} == 2);",
        "29": "\trefresh();\t",
        "30": "\teq1 = '';",
        "31": "\teq2 = '';",
        "32": "\tif ( ${batt_calendar_choice} == 1 )",
        "33": "\t{",
        "34": "\t\teq1 = 'q = 1.02 - k_cal * sqrt(t)'; ",
        "35": "\t\teq2 = 'k_cal = 0.00266*exp[-7280*(1/T-1/296)]*exp[939*(SOC/T-1/296)]';",
        "36": "\t}",
        "37": "\tproperty('lbl_empirical_equation1', 'Caption', eq1);",
        "38": "\tproperty('lbl_empirical_equation2', 'Caption', eq2);",
        "39": "\t",
        "40": "\tplot_calendar_life();",
        "41": "};",
        "42": "",
        "43": "function cycle_calendar_message()",
        "44": "{",
        "45": "\tmsg = 'Use the options and tables below to define cycle degradation and calendar degradation curves. SAM automatically updates these inputs when you choose a battery type on the Battery Cell and System page. The empirical calendar degradation model is suitable for Lithium-ion batteries. See help for details.';",
        "46": "\tclr = 'Black';",
        "47": "\tif ( technology() == 'Fuel Cell' && ${ui_batt_life_model} != 0 )",
        "48": "\t{",
        "49": "\t\tlife_options = ['Cycle and Calendar Degradation','Li-ion NMC/Graphite','Li-ion LMO/LTO'];",
        "50": "\t\tmsg = 'Disregard these inputs because the Cycle and Calendar degradation curves are not used for the ' + life_options[${ui_batt_life_model}] + ' option.';",
        "51": "\t\tclr = 'Red';",
        "52": "\t}",
        "53": "\tproperty('lbl_cycle_calendar', 'Caption', msg);",
        "54": "\tproperty('lbl_cycle_calendar', 'TextColour', clr);",
        "55": "\tenable_cycle_calendar_inputs();",
        "56": "}",
        "57": "",
        "58": "function enable_cycle_calendar_inputs()",
        "59": "{",
        "60": "\tis_calendar_life = ( ${ui_batt_life_model} == 0 );",
        "61": "\tenable('batt_lifetime_matrix',is_calendar_life);",
        "62": "\tenable('batt_calendar_lifetime_matrix',is_calendar_life);",
        "63": "\tenable('batt_calendar_choice',is_calendar_life);",
        "64": "\tshow('plot_cap_vs_cycle',is_calendar_life);",
        "65": "\tshow('batt_calendar_life_plot',is_calendar_life);",
        "66": "\trefresh();",
        "67": "}",
        "68": "",
        "69": "function plot_calendar_life()",
        "70": "{",
        "71": "\tclearplot('batt_calendar_life_plot');",
        "72": "\tsetplot('batt_calendar_life_plot');",
        "73": "\t",
        "74": "\t// vectors to plot",
        "75": "\tt = [];",
        "76": "\tq = [];",
        "77": "\t",
        "78": "\tT_vec = [];",
        "79": "\tSOC_vec = [];",
        "80": "\tcolor_string = [];",
        "81": "\tlegend_string = [];",
        "82": "\t",
        "83": "\tif ( ${batt_calendar_choice} == 0 )",
        "84": "\t{",
        "85": "\t\tplotopt( { 'title'='No Calendar Degradation', 'legend'=false });",
        "86": "\t}",
        "87": "\telseif ( ${batt_calendar_choice} == 1 )",
        "88": "\t{",
        "89": "\t\ta = value('batt_calendar_a');",
        "90": "\t\tb = value('batt_calendar_b');",
        "91": "\t\tc = value('batt_calendar_c');",
        "92": "\t\tq0 = value('batt_calendar_q0');",
        "93": "\t\t",
        "94": "\t\tdt_day = 10; // assume timestep of 10 days",
        "95": "\t\tdq_old = 0;",
        "96": "\t\tcount = 0;",
        "97": "\t\tyears = 10;",
        "98": "\t\t",
        "99": "\t\tT_vec = [293, 303, 313, 323]; ",
        "100": "\t\tSOC_vec = [0.5, 1.0, 0.5, 1.0];",
        "101": "\t\ttable = cell_voltage_vs_dod();",
        "102": "\t\tV = table{'V'};",
        "103": "\t\tDOD = table{'DOD'};",
        "104": "\t\t",
        "105": "\t\tV_vec = [];",
        "106": "\t\tfor (j = 0; j < #SOC_vec; j++)",
        "107": "\t\t{",
        "108": "\t\t\tV_vec[j] = 0;",
        "109": "\t\t\tfor (i = 0; i < #DOD; i++)",
        "110": "\t\t\t{",
        "111": "\t\t\t\tif (1 - DOD[i]*0.01 == SOC_vec[j])",
        "112": "\t\t\t\t{",
        "113": "\t\t\t\t\tV_vec[j] = V[i];",
        "114": "\t\t\t\t}",
        "115": "\t\t\t}",
        "116": "\t\t}",
        "117": "\t\t\t",
        "118": "\t\tcolor_string = ['blue', 'green', 'red', 'yellow'];",
        "119": "\t\tlegend_string[0] = [ 'T=20C, SOC=50%'];",
        "120": "\t\tlegend_string[1] = [ 'T=30C, SOC=100%'];",
        "121": "\t\tlegend_string[2] = [ 'T=40C, SOC=50%'];",
        "122": "\t\tlegend_string[3] = [ 'T=50C, SOC=100%'];",
        "123": "\t",
        "124": "\t\tt_max = 0;",
        "125": "\t\t",
        "126": "\t\tfor (scenario=0; scenario != #T_vec; scenario++)",
        "127": "\t\t{",
        "128": "\t\t",
        "129": "\t\t\tT = T_vec[scenario];",
        "130": "\t\t\tSOC = SOC_vec[scenario]; ",
        "131": "\t\t\tV = V_vec[scenario];",
        "132": "\t\t\tk_cal = a * exp(b*(1/T - 1/296)) * exp(c*(SOC/T - SOC/296));",
        "133": "\t\t\tq = [];",
        "134": "\t\t\tt = [];",
        "135": "\t\t",
        "136": "\t\t\tfor (day = 0; day != years * 360; day+=10)",
        "137": "\t\t\t{",
        "138": "\t\t\t\tdq_new = 0;",
        "139": "\t\t\t\tif (day == 0)",
        "140": "\t\t\t\t\tdq_new = k_cal*sqrt(dt_day);",
        "141": "\t\t\t\telse",
        "142": "\t\t\t\t\tdq_new = (0.5 * pow(k_cal, 2) / dq_old) * dt_day + dq_old;",
        "143": "\t\t\t\t",
        "144": "\t\t\t\tdq_old = dq_new;",
        "145": "",
        "146": "\t\t\t\tq_tmp = (q0 - dq_new)*100;",
        "147": "\t\t\t\t",
        "148": "\t\t\t\tif (q >=0)",
        "149": "\t\t\t\t{",
        "150": "\t\t\t\t\tq[count] = q_tmp;",
        "151": "\t\t\t\t\tt[count] = day;",
        "152": "\t\t\t\t}",
        "153": "\t\t\t\telse",
        "154": "\t\t\t\t{",
        "155": "\t\t\t\t\tif (day > t_max)",
        "156": "\t\t\t\t\t\tt_max = day;",
        "157": "\t\t\t\t\tbreak;",
        "158": "\t\t\t\t}",
        "159": "\t\t\t\t\t",
        "160": "\t\t\t\tcount++;",
        "161": "\t\t\t}",
        "162": "\t\t\tplot(t, q, {'thick'=2, 'type'='line', 'color'=color_string[scenario], 'series'=legend_string[scenario]});\t",
        "163": "\t\t}",
        "164": "\t\tplotopt( { 'title'='Empirical Calendar Degradation', 'legend'=true, 'legendpos'='right' });",
        "165": "\t\taxis( 'x1', {'label'='Age of battery (days)', 'min'=0, 'max'=max(t)+10});",
        "166": "\t\taxis( 'y1', {'label'='Effective capacity (%)', 'min'=0, 'max'=100});",
        "167": "\t}",
        "168": "\telseif (${batt_calendar_choice} == 2)",
        "169": "\t{",
        "170": "\t\tT_vec = [293];",
        "171": "\t\tSOC_vec = [0.5];",
        "172": "\t\tcolor_string = ['blue'];",
        "173": "\t\t",
        "174": "\t\tdata = value('batt_calendar_lifetime_matrix');\t\t\t\t",
        "175": "\t\tif (#data < 2)",
        "176": "\t\t\tbreak;",
        "177": "\t\t\t",
        "178": "\t\tfor (i = 0; i != #data; i++)",
        "179": "\t\t{",
        "180": "\t\t\tt[i] = data[i][0];",
        "181": "\t\t\tq[i] = data[i][1];",
        "182": "\t\t}",
        "183": "\t\tt_max = max(t);",
        "184": "\t\tplot(t, q, {'thick'=2, 'type'='line', 'color'=color_string[0]});\t",
        "185": "\t\tplotopt( { 'title'='Custom Calendar Degradation', 'legend'=false });",
        "186": "\t\taxis( 'x1', {'label'='Age of battery (days)', 'min'=0, 'max'=max(t)+10});",
        "187": "\t\taxis( 'y1', {'label'='Effective capacity (%)', 'min'=0, 'max'=100});",
        "188": "\t}",
        "189": "}",
        "190": "",
        "191": "on_change{ 'batt_lifetime_matrix' } = define() {",
        "192": "",
        "193": "\tsetplot( 'plot_cap_vs_cycle' );",
        "194": "\t",
        "195": "\tblm = ${batt_lifetime_matrix};",
        "196": "\tfor( i=0;i<#blm;i++ ) {",
        "197": "\t\tD[i] = blm[i][0];",
        "198": "\t\tn[i] = blm[i][1];",
        "199": "\t\tC[i] = blm[i][2];",
        "200": "\t\t// logmsg('D: ' + D[i] + ' n: ' + n[i] + ' C: ' + C[i]);",
        "201": "\t}",
        "202": "\tD_unique[0] = D[0];",
        "203": "\tlegend_string[0] = 'DoD: ' + to_string(D[0]) +'%';",
        "204": "\tindex = 1;",
        "205": "\tfor ( i=0;i<#D;i++){",
        "206": "\t\tcontained = false;",
        "207": "\t\tfor ( j=0;j<#D_unique;j++){",
        "208": "\t\t\tif ( D[i] == D_unique[j] )",
        "209": "\t\t\t{",
        "210": "\t\t\t\tcontained = true;",
        "211": "\t\t\t\tbreak;",
        "212": "\t\t\t}",
        "213": "\t\t}",
        "214": "\t\tif (contained == false)",
        "215": "\t\t{",
        "216": "\t\t\tD_unique[index] = D[i];",
        "217": "\t\t\tlegend_string[index] = 'DoD: ' + to_string(D[i]) +'%';",
        "218": "\t\t\tindex++;",
        "219": "\t\t\t//logmsg('D_unique: ' + D_unique);",
        "220": "\t\t}",
        "221": "\t}",
        "222": "",
        "223": "\tclearplot();",
        "224": "\tcolor_string_array = ['blue', 'green', 'red', 'yellow', 'black'];",
        "225": "\t",
        "226": "\tindex = 0;",
        "227": "\tfor (i = 0; i<#D_unique; i++){",
        "228": "\t\tn_plot = [];",
        "229": "\t\tC_plot = [];",
        "230": "\t\tD_plot = [];",
        "231": "\t\tfor (j = 0; j<#D; j++){",
        "232": "\t\t\tif (D[j] == D_unique[i])",
        "233": "\t\t\t{",
        "234": "\t\t\t\tn_plot[index] = n[j];",
        "235": "\t\t\t\tC_plot[index] = C[j];",
        "236": "\t\t\t\tD_plot[index] = D[j];",
        "237": "\t\t\t\tindex++;",
        "238": "\t\t\t}",
        "239": "\t\t}",
        "240": "\t\tplot( n_plot, C_plot, {'thick'=2, 'type'='line', 'color'=color_string_array[i], 'series'=legend_string[i]});",
        "241": "",
        "242": "\t}",
        "243": "\tplotopt( {'title'='Cycle Degradation', 'legend'=true, 'legendpos'='right'});",
        "244": "\tmax_y = max(max(C), 100);",
        "245": "\taxis( 'x1', {'label'='Cycle number', 'min'=0, 'max'=max(n)+100});",
        "246": "\taxis( 'y1', {'label'='Effective capacity (%)', 'min'=0, 'max'=max_y});",
        "247": "};",
        "248": ""
    }
}
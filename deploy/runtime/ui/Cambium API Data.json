{
    "Name": "Cambium API Data",
    "Width": 869.0,
    "Height": 389.0,
    "FormObjects": {
        "Button": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "btn_cambium_to_lifetime"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 147.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 327.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 340.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 28.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Caption": {
                    "Type": 5.0,
                    "String": "Download price data"
                },
                "TabOrder": {
                    "Type": 3.0,
                    "Integer": -1.0
                }
            }
        },
        "Choice": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "cambium_location"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 123.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 183.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 220.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 24.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Items": {
                    "Type": 6.0,
                    "StringList": ""
                },
                "Selection": {
                    "Type": 3.0,
                    "Integer": -1.0
                },
                "TabOrder": {
                    "Type": 3.0,
                    "Integer": -1.0
                }
            }
        },
        "Choice": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "cambium_location_type"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 123.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 156.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 220.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 24.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Items": {
                    "Type": 6.0,
                    "StringList": ""
                },
                "Selection": {
                    "Type": 3.0,
                    "Integer": -1.0
                },
                "TabOrder": {
                    "Type": 3.0,
                    "Integer": -1.0
                }
            }
        },
        "Choice": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "cambium_metric"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 123.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 264.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 220.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 24.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Items": {
                    "Type": 6.0,
                    "StringList": "Cost: End Use Energy [$/MWh]|Cost: End Use Capacity [$/MWh]"
                },
                "Selection": {
                    "Type": 3.0,
                    "Integer": -1.0
                },
                "TabOrder": {
                    "Type": 3.0,
                    "Integer": -1.0
                }
            }
        },
        "Choice": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "cambium_scenario"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 123.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 291.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 220.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 24.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": "Choose a scenario"
                },
                "Items": {
                    "Type": 6.0,
                    "StringList": ""
                },
                "Selection": {
                    "Type": 3.0,
                    "Integer": -1.0
                },
                "TabOrder": {
                    "Type": 3.0,
                    "Integer": -1.0
                }
            }
        },
        "Choice": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "cambium_start_year"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 243.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 237.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 100.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 24.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Items": {
                    "Type": 6.0,
                    "StringList": ""
                },
                "Selection": {
                    "Type": 3.0,
                    "Integer": 0.0
                },
                "TabOrder": {
                    "Type": 3.0,
                    "Integer": -1.0
                }
            }
        },
        "Choice": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "cambium_year"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 123.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 210.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 220.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 24.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Items": {
                    "Type": 6.0,
                    "StringList": ""
                },
                "Selection": {
                    "Type": 3.0,
                    "Integer": -1.0
                },
                "TabOrder": {
                    "Type": 3.0,
                    "Integer": -1.0
                }
            }
        },
        "Divider": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "object 21"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 21.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 117.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 342.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 16.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Orientation": {
                    "Type": 3.0,
                    "Integer": 0.0
                },
                "Colour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 120.0,
                        "Green": 120.0,
                        "Blue": 120.0,
                        "Alpha": 255.0
                    }
                },
                "Caption": {
                    "Type": 5.0,
                    "String": "Cambium API Parameters"
                },
                "Bold": {
                    "Type": 2.0,
                    "Boolean": 1.0
                }
            }
        },
        "GroupBox": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "object 4"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 6.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 6.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 850.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 367.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Caption": {
                    "Type": 5.0,
                    "String": "NREL Cambium Hourly Price Data Download"
                },
                "Bold": {
                    "Type": 2.0,
                    "Boolean": 1.0
                }
            }
        },
        "Label": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "object 7"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 15.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 30.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 816.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 72.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Caption": {
                    "Type": 5.0,
                    "String": "NREL's Cambium 2020 database provides hourly marginal cost data for modeled futures of the U.S. electricity sector. This data may be suitable as approximations of market prices for the energy market or ancillary services to use with SAM's Merchant Plant financial model. See Help for details and references."
                },
                "TextColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 0.0,
                        "Green": 0.0,
                        "Blue": 0.0,
                        "Alpha": 255.0
                    }
                },
                "Bold": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "FontSize": {
                    "Type": 3.0,
                    "Integer": 0.0
                },
                "WordWrap": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "AlignRight": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "AlignTop": {
                    "Type": 2.0,
                    "Boolean": 1.0
                }
            }
        },
        "ToolTipCtrl": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "tt_cambium_location"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 348.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 183.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 36.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 24.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Tips": {
                    "Type": 5.0,
                    "String": ""
                },
                "TipTitle": {
                    "Type": 5.0,
                    "String": ""
                }
            }
        },
        "ToolTipCtrl": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "tt_cambium_location_type"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 348.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 156.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 36.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 24.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Tips": {
                    "Type": 5.0,
                    "String": ""
                },
                "TipTitle": {
                    "Type": 5.0,
                    "String": ""
                }
            }
        },
        "ToolTipCtrl": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "tt_cambium_metric"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 348.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 264.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 36.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 24.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Tips": {
                    "Type": 5.0,
                    "String": ""
                },
                "TipTitle": {
                    "Type": 5.0,
                    "String": ""
                }
            }
        },
        "ToolTipCtrl": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "tt_cambium_scenario"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 348.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 291.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 36.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 24.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Tips": {
                    "Type": 5.0,
                    "String": ""
                },
                "TipTitle": {
                    "Type": 5.0,
                    "String": ""
                }
            }
        },
        "ToolTipCtrl": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "tt_cambium_year"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 348.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 210.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 36.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 24.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Tips": {
                    "Type": 5.0,
                    "String": ""
                },
                "TipTitle": {
                    "Type": 5.0,
                    "String": ""
                }
            }
        },
        "MultilineText": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "txt_instructions"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 411.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 132.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 423.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 180.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Text": {
                    "Type": 5.0,
                    "String": ""
                },
                "Editable": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "ForeColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 0.0,
                        "Green": 0.0,
                        "Blue": 0.0,
                        "Alpha": 255.0
                    }
                },
                "BackColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 255.0,
                        "Green": 255.0,
                        "Blue": 255.0,
                        "Alpha": 255.0
                    }
                },
                "TabOrder": {
                    "Type": 3.0,
                    "Integer": -1.0
                }
            }
        }
    },
    "VarDatabase": {
        "cambium_location": {
            "Version": 4.0,
            "Type": 4.0,
            "Label": "Location",
            "Units": " ",
            "Group": "Cambium Download",
            "IndexLabels": "",
            "Flags": 0.0,
            "DefaultValue": "",
            "UIObject": "Choice",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "cambium_location_type": {
            "Version": 4.0,
            "Type": 4.0,
            "Label": "Location type",
            "Units": " ",
            "Group": "Cambium Download",
            "IndexLabels": "",
            "Flags": 0.0,
            "DefaultValue": "",
            "UIObject": "Choice",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "cambium_meta_output": {
            "Version": 4.0,
            "Type": 4.0,
            "Label": " ",
            "Units": " ",
            "Group": "Cambium Download",
            "IndexLabels": "",
            "Flags": 0.0,
            "DefaultValue": "",
            "UIObject": "Default",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "cambium_metric": {
            "Version": 4.0,
            "Type": 4.0,
            "Label": "Metric",
            "Units": " ",
            "Group": "Cambium Download",
            "IndexLabels": "",
            "Flags": 0.0,
            "DefaultValue": "",
            "UIObject": "Choice",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "cambium_scenario": {
            "Version": 4.0,
            "Type": 4.0,
            "Label": "Scenario",
            "Units": " ",
            "Group": "Cambium Download",
            "IndexLabels": "",
            "Flags": 0.0,
            "DefaultValue": "",
            "UIObject": "Choice",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "cambium_start_year": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "Start year for multiple year option",
            "Units": " ",
            "Group": "Cambium Download",
            "IndexLabels": "",
            "Flags": 0.0,
            "DefaultValue": 0.0,
            "UIObject": "Choice",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "cambium_year": {
            "Version": 4.0,
            "Type": 4.0,
            "Label": "Year",
            "Units": " ",
            "Group": "Cambium Download",
            "IndexLabels": "",
            "Flags": 0.0,
            "DefaultValue": "0",
            "UIObject": "Choice",
            "sscVariableName": "",
            "sscVariableValue": ""
        }
    },
    "Equations": {},
    "Callbacks": {
        "1": "on_load{'Cambium API Data'} = define() {",
        "2": "\t// globals for api meta data",
        "3": "\tglobal project_uuid = '579698fe-5a38-4d7c-8611-d0c5969b2e54';",
        "4": "\tglobal api_meta_json = {};",
        "5": "\tglobal global_years = [];",
        "6": "",
        "7": "\t// UI option globals",
        "8": "\tglobal cambium_enable = true;",
        "9": "\tglobal dynamic_option = 'Multiple years';\t// dynamic year option text",
        "10": "",
        "11": "\t// api globals for storing both the option and the description",
        "12": "\tglobal api_metrics = {};",
        "13": "\tglobal api_scenarios = {};",
        "14": "\t",
        "15": "\t// global matrix for the data target map from the choice widget",
        "16": "\tglobal cambium_target = [['mp_enable_energy_market_revenue','mp_energy_market_revenue',",
        "17": "\t\t\t\t\t\t\t\t'mp_enable_market_percent_gen','mp_energy_market_revenue_single','Energy Market'],",
        "18": "\t\t\t\t\t\t\t\t['mp_enable_ancserv1','mp_ancserv1_revenue',",
        "19": "\t\t\t\t\t\t\t\t'mp_enable_ancserv1_percent_gen','mp_ancserv1_revenue_single','Ancillary Service 1'],",
        "20": "\t\t\t\t\t\t\t\t['mp_enable_ancserv2','mp_ancserv2_revenue',",
        "21": "\t\t\t\t\t\t\t\t'mp_enable_ancserv2_percent_gen','mp_ancserv2_revenue_single','Ancillary Service 2'],",
        "22": "\t\t\t\t\t\t\t\t['mp_enable_ancserv3','mp_ancserv3_revenue',",
        "23": "\t\t\t\t\t\t\t\t'mp_enable_ancserv3_percent_gen','mp_ancserv3_revenue_single','Ancillary Service 3'],",
        "24": "\t\t\t\t\t\t\t\t['mp_enable_ancserv4','mp_ancserv4_revenue',",
        "25": "\t\t\t\t\t\t\t\t'mp_enable_ancserv4_percent_gen','mp_ancserv4_revenue_single','Ancillary Service 4']];",
        "26": "",
        "27": "\t// make an api call",
        "28": "\tapi_call = '0';",
        "29": "\tif ( value('cambium_meta_output') == '' )",
        "30": "\t{",
        "31": "\t\tapi_call = curl(webapi('cambium_meta'));",
        "32": "\t}",
        "33": "\t",
        "34": "\t// if curl fails",
        "35": "\tif( api_call == 0 && cambium_enable)",
        "36": "\t{",
        "37": "\t\tcambium_enable = false;",
        "38": "\t\tmsgbox('Cambium Error\\nA problem with your internet connection or the Cambium API\\n'",
        "39": "\t\t\t + 'is preventing SAM from downloading Cambium data.\\n\\n' ",
        "40": "\t\t\t + 'Cambium inputs will be disabled until the problem is resolved.');",
        "41": "\t}",
        "42": "\telseif(value('cambium_meta_output') == '' )",
        "43": "\t{",
        "44": "\t\tvalue('cambium_meta_output',api_call);",
        "45": "\t}\t",
        "46": "",
        "47": "\t// if html response",
        "48": "\tif(ch(value('cambium_meta_output'),0) == '<' || ch(value('cambium_meta_output'),1) == '<')",
        "49": "\t{",
        "50": "\t\tdisplay_cambium_error(value('cambium_meta_output'));",
        "51": "\t}",
        "52": "\telseif(cambium_enable)",
        "53": "\t{",
        "54": "\t\tapi_meta_json = json_read(value('cambium_meta_output'));",
        "55": "\t\t// if json html response",
        "56": "\t\tif(strcmp((@api_meta_json)[0],'message') == 0 && #api_meta_json == 1)",
        "57": "\t\t{",
        "58": "\t\t\tdisplay_cambium_error(api_meta_json.message);",
        "59": "\t\t}",
        "60": "\t\t// normal json response",
        "61": "\t\telse",
        "62": "\t\t{",
        "63": "\t\t\t// create scenario selection",
        "64": "\t\t\tapi_scenarios = get_api_json('scenarios');",
        "65": "\t\t\t",
        "66": "\t\t\t// create metrics selection",
        "67": "\t\t\tfor(i=0;i<#api_meta_json.meta.metrics;i++)",
        "68": "\t\t\t\t// only keep cost options",
        "69": "\t\t\t\tif(strcmp(left(api_meta_json.meta.metrics[i][0],4),'Cost') == 0)",
        "70": "\t\t\t\t\tapi_metrics{api_meta_json.meta.metrics[i][0]} = api_meta_json.meta.metrics[i][2];",
        "71": "",
        "72": "\t\t\tfor(i=0;i<#api_meta_json.meta.years; i++)",
        "73": "\t\t\t\t\tyears[i] = api_meta_json.meta.years[i][0];",
        "74": "\t\t\t",
        "75": "\t\t\t// retain years without dynamic option",
        "76": "\t\t\tglobal_years = years;\t",
        "77": "\t\t\t",
        "78": "\t\t\t// add dynamic option if feasible",
        "79": "\t\t\tif(value('analysis_period')<2*(#years))",
        "80": "\t\t\t\tyears[#years] = dynamic_option;",
        "81": "\t\t\t",
        "82": "\t\t\t// update choice fields",
        "83": "\t\t\tproperty('cambium_location_type','Items',@api_meta_json.meta.locations);",
        "84": "\t\t\tproperty('cambium_scenario','Items',@api_scenarios);",
        "85": "\t\t\tproperty('cambium_metric','Items',@api_metrics);",
        "86": "\t\t\tproperty('cambium_year','Items',years);",
        "87": "\t\t\tproperty('btn_cambium_to_lifetime','Caption','Download to '+cambium_target[value('revenue_tab')][4]);",
        "88": "\t\t}",
        "89": "\t}",
        "90": "",
        "91": "    txt = '1. Choose Cambium API parameters from the lists at left.\\n\\n' +",
        "92": "        '2. Click the Energy Market or one of the Ancillary Service tabs below.\\n\\n' +",
        "93": "        '3. Enable the energy market or ancillary service, and choose either the Cleared Capacity and Price or Price option.' +",
        "94": "        ' (The Cambium database has price data but not cleared capacity data.)\\n\\n' +",
        "95": "        '4. Click the Download button.\\n\\n' +",
        "96": "        'See Help for details.';",
        "97": "\tproperty('txt_instructions','Text',txt);",
        "98": "\tenable('cambium_location', value('cambium_location_type') != '');",
        "99": "\tupdate_tips();",
        "100": "\ton_change{'cambium_location_type'}();",
        "101": "\tupdate_dynamic_years();",
        "102": "\tupdate_submission_btn();",
        "103": "\t",
        "104": "\trefresh();",
        "105": "};",
        "106": "",
        "107": "get_api_json = define(key) {",
        "108": "\treturn_json = {};",
        "109": "\t// initialize json of descriptions mapped to the objects they describe",
        "110": "\tfor(i=0;i<#api_meta_json.meta{key};i++)",
        "111": "\t\treturn_json{api_meta_json.meta{key}[i][0]} = api_meta_json.meta{key}[i][2];",
        "112": "\t",
        "113": "\treturn return_json;",
        "114": "};",
        "115": "",
        "116": "on_change{'cambium_location_type'} = define() {",
        "117": "\tif(cambium_enable)",
        "118": "\t{",
        "119": "\t\tlocation_type = value('cambium_location_type');",
        "120": "\t\t",
        "121": "\t\tif( in_array(location_type,@api_meta_json.meta.locations) )",
        "122": "\t\t{",
        "123": "\t\t\t// extract locations from the metadata based on type field",
        "124": "\t\t\tfor(i=0;i<#api_meta_json.meta.locations{location_type}; i++)",
        "125": "\t\t\t\tlocations[i] = api_meta_json.meta.locations{location_type}[i][0];",
        "126": "\t\t\t",
        "127": "\t\t\tproperty('cambium_location','Items',locations);",
        "128": "\t\t\tenable('cambium_location',true);",
        "129": "\t\t\trefresh();",
        "130": "\t\t}",
        "131": "\t\telse",
        "132": "\t\t\tenable('cambium_location',false);",
        "133": "\t\t",
        "134": "\t\tupdate_submission_btn();",
        "135": "\t}",
        "136": "};",
        "137": "",
        "138": "on_change{'cambium_scenario'} = define() {",
        "139": "\tupdate_tips();",
        "140": "\tupdate_submission_btn();",
        "141": "};",
        "142": "",
        "143": "on_change{'cambium_metric'} = define() {",
        "144": "\tupdate_tips();",
        "145": "\tupdate_submission_btn();",
        "146": "};",
        "147": "",
        "148": "update_tips = define() {",
        "149": "\tproperty('tt_cambium_scenario','TipTitle','Scenario Description from Cambium API');",
        "150": "\tproperty('tt_cambium_scenario','Tips',${cambium_scenario} + ': ' + api_scenarios{value('cambium_scenario')});",
        "151": "\tproperty('tt_cambium_metric','TipTitle','Metric Description from Cambium API');",
        "152": "\tproperty('tt_cambium_metric','Tips',${cambium_metric} + ': ' + api_metrics{value('cambium_metric')});",
        "153": "};",
        "154": "",
        "155": "// update submission button enable regardless of which input is filled last",
        "156": "on_change{'cambium_location'} = define() {",
        "157": "\tupdate_submission_btn();",
        "158": "};",
        "159": "",
        "160": "on_change{'cambium_year'} = define() {",
        "161": "\tupdate_dynamic_years();",
        "162": "\tupdate_submission_btn();",
        "163": "\trefresh();",
        "164": "};",
        "165": "",
        "166": "// enable submission button if all requirements are met",
        "167": "update_submission_btn = define() {",
        "168": "\tenable('btn_cambium_to_lifetime', ",
        "169": "\t   value('cambium_location_type') != ''",
        "170": "\t\t&& value('cambium_location') != ''",
        "171": "\t\t&& value('cambium_metric') != ''",
        "172": "\t\t&& value('cambium_scenario') != ''",
        "173": "\t\t&& ((value('cambium_year') != '' && value('cambium_year') != dynamic_option)",
        "174": "\t\t|| (value('cambium_year') == dynamic_option && #property('cambium_start_year','Items')>0))",
        "175": "\t\t&& cambium_enable);",
        "176": "};",
        "177": "",
        "178": "// when submission button is pressed, API call is made ",
        "179": "on_change{'btn_cambium_to_lifetime'} = define() {",
        "180": "\tif(!value(cambium_target[value('revenue_tab')][0]))",
        "181": "\t{",
        "182": "\t\tmsgbox('Cambium Error\\nEnable ' + cambium_target[value('revenue_tab')][4] + ' before downloading.');",
        "183": "\t\treturn;",
        "184": "\t}",
        "185": "\t",
        "186": "\tif(value('cambium_year') == dynamic_option)",
        "187": "\t{",
        "188": "\t\tdynamic_cambium_download();",
        "189": "\t}",
        "190": "\telse",
        "191": "\t{",
        "192": "\t\tnormal_cambium_download();",
        "193": "\t}\t",
        "194": "};",
        "195": "",
        "196": "// download data for multiple years to increment throughout the analysis period",
        "197": "dynamic_cambium_download = define() {",
        "198": "\tyear_idx = to_int(value('cambium_start_year'));",
        "199": "\tpb = progressbar({",
        "200": "\t\t\t\t\t\t'title' = 'API Call Progress',",
        "201": "\t\t\t\t\t\t'message' = 'Making API call for '+global_years[year_idx],",
        "202": "\t\t\t\t\t\t'cancelbutton' = true,",
        "203": "\t\t\t\t\t\t'closebutton' = false,",
        "204": "\t\t\t\t\t\t'time' = false,",
        "205": "\t\t\t\t\t\t'max' = 2*to_int(value(\"analysis_period\"))+1",
        "206": "\t\t\t\t\t});",
        "207": "\t\t\t\t\t",
        "208": "\t// Copy into either the price-only matrix or the 2-col matrix for this target selection",
        "209": "\tif(value(cambium_target[value('revenue_tab')][2]))",
        "210": "\t{",
        "211": "\t\tprice_index = 0;\t// copy price into first column",
        "212": "\t\tvariable_name_index = 3;",
        "213": "\t}",
        "214": "\telse",
        "215": "\t{",
        "216": "\t\tprice_index = 1; \t// copy price in to second column",
        "217": "\t\tvariable_name_index = 1;",
        "218": "\t}",
        "219": "\t// copy the existing data matrix to copy to it (one of the columns may already have data)",
        "220": "\tdata_matrix = value(cambium_target[value('revenue_tab')][variable_name_index]);",
        "221": "\t",
        "222": "\tfor(i=0;i<to_int(value(\"analysis_period\"));i++)",
        "223": "\t{",
        "224": "\t\tyear_string = to_string(global_years[year_idx+i/2]);",
        "225": "\t\teven_bool = ((i-to_int(i/2)*2) == 0);",
        "226": "\t\t",
        "227": "\t\t// if i is even, make an api call",
        "228": "\t\tif(even_bool)",
        "229": "\t\t{",
        "230": "\t\t\tprogressbar(pb, {'message' = 'Making API call for '+year_string+'...','value' = 2*i});",
        "231": "\t\t\tapi_curl_output = cambium_api_call(global_years[year_idx+i/2]);",
        "232": "\t\t\t",
        "233": "\t\t\t// if curl fails",
        "234": "\t\t\tif(api_curl_output == 0)",
        "235": "\t\t\t{",
        "236": "\t\t\t\tcambium_enable = false;",
        "237": "\t\t\t\tmsgbox('Cambium Error\\nNo internet or problem connecting to Cambium API. The Download button will be disabled until the problem is resolved.');",
        "238": "\t\t\t\tupdate_submission_btn();",
        "239": "\t\t\t\tprogressbar(pb);",
        "240": "\t\t\t\treturn;",
        "241": "\t\t\t}",
        "242": "\t\t\t// if html response",
        "243": "\t\t\tif(ch(api_curl_output,0) == '<' || ch(api_curl_output,1) == '<')",
        "244": "\t\t\t{",
        "245": "\t\t\t\tprogressbar(pb);",
        "246": "\t\t\t\tdisplay_cambium_error(api_curl_output);",
        "247": "\t\t\t\treturn;",
        "248": "\t\t\t}",
        "249": "\t\t\t",
        "250": "\t\t\tapi_data_json = json_read(api_curl_output);",
        "251": "\t\t\t// if json html response",
        "252": "\t\t\tif(strcmp((@api_data_json)[0],'message') == 0 && #api_data_json == 1)",
        "253": "\t\t\t{",
        "254": "\t\t\t\tprogressbar(pb);",
        "255": "\t\t\t\tdisplay_cambium_error(api_data_json.message);",
        "256": "\t\t\t\treturn;",
        "257": "\t\t\t}",
        "258": "\t\t} else ",
        "259": "\t\t\tyear_string += ' duplicate';",
        "260": "\t\t\t",
        "261": "\t\tpb_canceled = progressbar(pb, {'message' = 'Copying hourly data for '+year_string+'...','value' = 2*i+1});",
        "262": "\t\tfor(j=0;j<#api_data_json.data.layers[0].y;j++)",
        "263": "\t\t{",
        "264": "\t\t\tdata_matrix[i*#api_data_json.data.layers[0].y+j][price_index]=api_data_json.data.layers[0].y[j];",
        "265": "\t\t}",
        "266": "\t\tif(pb_canceled)",
        "267": "\t\t{",
        "268": "\t\t\tprogressbar(pb);",
        "269": "\t\t\treturn;",
        "270": "\t\t}",
        "271": "\t}",
        "272": "\tprogressbar(pb, {'message' = 'Setting lifetime data...','value' = 2*value(\"analysis_period\")});",
        "273": "\t\t\t\t",
        "274": "\t// force mode change to hourly",
        "275": "\tproperty(cambium_target[value('revenue_tab')][variable_name_index],'Mode','Hourly');",
        "276": "\tvalue(cambium_target[value('revenue_tab')][variable_name_index],data_matrix);",
        "277": "\t",
        "278": "\tprogressbar(pb);",
        "279": "\t",
        "280": "};",
        "281": "",
        "282": "// download data for a single year repeated over the duration of the analysis period",
        "283": "normal_cambium_download = define() {",
        "284": "\tpb = progressbar({",
        "285": "\t\t\t\t\t\t'title' = 'API Call Progress',",
        "286": "\t\t\t\t\t\t'message' = 'Making API call...',",
        "287": "\t\t\t\t\t\t'cancelbutton' = true,",
        "288": "\t\t\t\t\t\t'closebutton' = false,",
        "289": "\t\t\t\t\t\t'time' = false,",
        "290": "\t\t\t\t\t\t'max' = 2*value(\"analysis_period\")+1",
        "291": "\t\t\t\t\t});",
        "292": "",
        "293": "\tapi_curl_output = cambium_api_call(value('cambium_year'));",
        "294": "\t// if curl fails",
        "295": "\tif(api_curl_output == 0)",
        "296": "\t{",
        "297": "\t\tcambium_enable = false;",
        "298": "\t\tmsgbox('Cambium Error\\nNo internet or problem connecting to Cambium API. The Download button will be disabled until the problem is resolved.');",
        "299": "\t\tupdate_submission_btn();",
        "300": "\t\tprogressbar(pb);",
        "301": "\t}",
        "302": "\t// if html response",
        "303": "\telse if(ch(api_curl_output,0) == '<' || ch(api_curl_output,1) == '<')",
        "304": "\t{",
        "305": "\t\tprogressbar(pb);",
        "306": "\t\tdisplay_cambium_error(api_curl_output);",
        "307": "\t}",
        "308": "\telse",
        "309": "\t{",
        "310": "\t\tapi_data_json = json_read(api_curl_output);",
        "311": "\t\t// if json html response",
        "312": "\t\tif(strcmp((@api_data_json)[0],'message') == 0 && #api_data_json == 1)",
        "313": "\t\t{",
        "314": "\t\t\tprogressbar(pb);",
        "315": "\t\t\tdisplay_cambium_error(api_data_json.message);",
        "316": "\t\t}",
        "317": "\t\t// if normal json response",
        "318": "\t\telse",
        "319": "\t\t{",
        "320": "\t\t\t// load into either the price-only matrix or the 2-col matrix for this target selection",
        "321": "\t\t\tif(value(cambium_target[value('revenue_tab')][2]))",
        "322": "\t\t\t{",
        "323": "\t\t\t\tprice_index = 0;\t// copy price into first column",
        "324": "\t\t\t\tvariable_name_index = 3;",
        "325": "\t\t\t}",
        "326": "\t\t\telse",
        "327": "\t\t\t{",
        "328": "\t\t\t\tprice_index = 1; \t// copy price in to second column",
        "329": "\t\t\t\tvariable_name_index = 1;",
        "330": "\t\t\t}",
        "331": "\t\t\t// copy the existing data matrix to copy to it (one of the columns may already have data)",
        "332": "\t\t\tdata_matrix = value(cambium_target[value('revenue_tab')][variable_name_index]);",
        "333": "\t\t\tprogressbar(pb, {'message' = 'Copying hourly data...','value' = value(\"analysis_period\")-1});",
        "334": "\t\t\t",
        "335": "\t\t\tfor(i=0;i<to_int(value(\"analysis_period\"));i++)",
        "336": "\t\t\t{",
        "337": "\t\t\t\tfor(j=0;j<#api_data_json.data.layers[0].y;j++)",
        "338": "\t\t\t\t{",
        "339": "\t\t\t\t\tdata_matrix[i*#api_data_json.data.layers[0].y+j][price_index]=api_data_json.data.layers[0].y[j];",
        "340": "\t\t\t\t}",
        "341": "\t\t\t\tpb_canceled = progressbar(pb, {'value' = to_int(value(\"analysis_period\"))+i});",
        "342": "\t\t\t\tif(pb_canceled)",
        "343": "\t\t\t\t{",
        "344": "\t\t\t\t\tprogressbar(pb);",
        "345": "\t\t\t\t\treturn;",
        "346": "\t\t\t\t}",
        "347": "\t\t\t}",
        "348": "\t\t\t",
        "349": "\t\t\tprogressbar(pb, {'message' = 'Setting lifetime data...','value' = 2*value(\"analysis_period\")});",
        "350": "\t\t\t",
        "351": "\t\t\t// force mode change to hourly",
        "352": "\t\t\tproperty(cambium_target[value('revenue_tab')][variable_name_index],'Mode','Hourly');",
        "353": "\t\t\tvalue(cambium_target[value('revenue_tab')][variable_name_index],data_matrix);",
        "354": "\t\t\t",
        "355": "\t\t\tprogressbar(pb);",
        "356": "\t\t}",
        "357": "\t}",
        "358": "};",
        "359": "",
        "360": "// submit the API call with the gathered data",
        "361": "cambium_api_call = define(year) {",
        "362": "\tinput_json = {",
        "363": "\t\t'location': value('cambium_location'),",
        "364": "\t\t'location_type': value('cambium_location_type'),",
        "365": "\t\t'metric': value('cambium_metric'),",
        "366": "\t\t'scenario': value('cambium_scenario'),",
        "367": "\t\t'scenario_diff': null,",
        "368": "\t\t'technology': 'ALL',",
        "369": "\t\t'technology_type': 'Technologies',",
        "370": "\t\t'year': year",
        "371": "\t};",
        "372": "\tpost_data = {",
        "373": "\t\t'project_uuid': project_uuid,",
        "374": "\t\t'inputs': input_json,",
        "375": "\t\t'x_axis': 'interval'",
        "376": "\t};",
        "377": "\treturn curl(webapi('cambium_query'),{\"post\":json_write(post_data)});",
        "378": "};",
        "379": "",
        "380": "// calculate the possible start years for the incremental option",
        "381": "update_dynamic_years = define() {",
        "382": "\tif(value('cambium_year') == dynamic_option)",
        "383": "\t{",
        "384": "\t\tyears = [];",
        "385": "\t\t// only show years up to what is supported in cambium based on analysis period",
        "386": "\t\tfor(i=0;i<#api_meta_json.meta.years-value('analysis_period')/2; i++)",
        "387": "\t\t\tyears[i] = api_meta_json.meta.years[i][0];",
        "388": "\t\tproperty('cambium_start_year','Items',years);",
        "389": "\t}",
        "390": "\t",
        "391": "\titems_present = #property('cambium_start_year','Items')>0;",
        "392": "\tenable('cambium_start_year',value('cambium_year') == dynamic_option && items_present);",
        "393": "};",
        "394": "",
        "395": "// show html dialog errors returned from the API",
        "396": "display_cambium_error = define(s) {",
        "397": "\thtml_dialog(s,'Cambium Error from API',[600,400],true);",
        "398": "};",
        "399": "",
        "400": "// true if item is in array",
        "401": "in_array = define(item,array) {",
        "402": "\tfor(i=0;i<#array;i++)",
        "403": "\t\tif(item == array[i])",
        "404": "\t\t\treturn true;",
        "405": "\treturn false;",
        "406": "};"
    }
}